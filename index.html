<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Polish Master Pro v2.1</title>
    
    <style>
        :root { 
            --primary: #1a73e8; --secondary: #34a853; --accent: #673ab7; 
            --bg: #f8f9fa; --card-bg: #ffffff; --text: #202124; --border: #dadce0;
        }
        .dark-mode { 
            --bg: #121212; --card-bg: #1e1e1e; --text: #e8eaed; --border: #3c4043;
        }
        
        * { box-sizing: border-box; }
        body { font-family: 'Segoe UI', sans-serif; background-color: var(--bg); color: var(--text); margin: 0; display: flex; flex-direction: column; align-items: center; padding: 10px; min-height: 100vh; }

        header { width: 100%; max-width: 400px; display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .icon-btn { background: var(--card-bg); border: 1px solid var(--border); border-radius: 8px; padding: 5px 10px; cursor: pointer; color: var(--text); }

        #startupPage {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.85); color: white; z-index: 9999;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            padding: 20px; text-align: center;
        }
        .start-box { background: var(--card-bg); color: var(--text); padding: 20px; border-radius: 20px; max-width: 350px; }

        .range-container { width: 100%; max-width: 400px; background: var(--card-bg); padding: 15px; border-radius: 15px; border: 1px solid var(--border); margin-bottom: 10px; }
        .slider-row { margin: 10px 0; }
        .slider-row label { display: block; font-size: 0.8rem; font-weight: bold; margin-bottom: 5px; }
        input[type=range] { width: 100%; accent-color: var(--primary); }

        .card { background: var(--card-bg); padding: 20px; border-radius: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); text-align: center; width: 100%; max-width: 400px; border: 1px solid var(--border); }
        .mode-toggle { display: flex; gap: 5px; margin-bottom: 15px; background: var(--bg); padding: 5px; border-radius: 10px; }
        .mode-toggle button { flex: 1; border: none; padding: 8px; border-radius: 8px; cursor: pointer; font-weight: bold; background: transparent; color: var(--text); }
        .mode-toggle button.active { background: var(--primary); color: white; }

        .display-area { margin: 10px 0; min-height: 120px; display: flex; flex-direction: column; justify-content: center; align-items: center; }
        .main-num { font-size: 2.5rem; font-weight: bold; color: var(--primary); }
        
        /* Heard Text Styling */
        #heardDisplay { font-size: 0.85rem; color: #666; margin-top: 10px; font-style: italic; background: #eee; padding: 4px 10px; border-radius: 5px; display: none; }
        .dark-mode #heardDisplay { background: #333; color: #aaa; }

        .mic-on { color: #d93025; font-weight: bold; display: none; margin-top: 10px; animation: blink 1s infinite; }
        @keyframes blink { 50% { opacity: 0.5; } }

        .btn-action { width: 100%; padding: 15px; border-radius: 12px; border: none; font-weight: bold; cursor: pointer; margin-top: 10px; font-size: 1rem; }
        .btn-next { background: var(--primary); color: white; }
        .btn-hf { background: var(--accent); color: white; }
    </style>
</head>
<body>

<div id="startupPage">
    <div class="start-box">
        <h2 style="color:var(--primary)">Polish Master</h2>
        <p>Optimized for <b>UK English</b> voice recognition.</p>
        <p>1. Hear Polish, say English.<br>2. Enable <b>Hands-Free</b>.<br>3. Check the "Heard" box if it mishears you.</p>
        <button class="btn-action btn-next" onclick="closeStartup()">START TRAINING</button>
    </div>
</div>

<header>
    <div style="font-weight: bold;">v2.1 PRO (UK-EN)</div>
    <button class="icon-btn" onclick="toggleDark()">üåô/‚òÄÔ∏è</button>
</header>

<div class="range-container">
    <div class="slider-row">
        <label>Min: <span id="minTxt">1</span></label>
        <input type="range" id="minIn" min="1" max="500" value="1" oninput="syncRange()">
    </div>
    <div class="slider-row">
        <label>Max: <span id="maxTxt">100</span></label>
        <input type="range" id="maxIn" min="2" max="999" value="100" oninput="syncRange()">
    </div>
</div>

<div class="card">
    <div class="mode-toggle">
        <button id="btnPlEn" class="active" onclick="setDir('pl-en')">PL ‚û°Ô∏è EN</button>
        <button id="btnEnPl" onclick="setDir('en-pl')">EN ‚û°Ô∏è PL</button>
    </div>

    <div class="display-area">
        <div id="numDisp" class="main-num">?</div>
        <div id="heardDisplay">Heard: "..."</div>
        <div id="micStatus" class="mic-on">üî¥ Listening (UK-EN)...</div>
    </div>

    <button class="btn-action btn-next" onclick="generateNext()">NEXT PHRASE</button>
    <button class="btn-action btn-hf" id="hfToggle" onclick="toggleHF()">ENABLE HANDS-FREE</button>
</div>

<script>
    let dir = 'pl-en', isHF = false, polish = "", english = "", recognition;
    
    function closeStartup() { document.getElementById('startupPage').style.display = 'none'; }
    function toggleDark() { document.body.classList.toggle('dark-mode'); }
    function syncRange() {
        let min = parseInt(document.getElementById('minIn').value);
        let max = parseInt(document.getElementById('maxIn').value);
        if(min >= max) { max = min + 1; document.getElementById('maxIn').value = max; }
        document.getElementById('minTxt').innerText = min;
        document.getElementById('maxTxt').innerText = max;
    }

    // --- RECOGNITION SETUP (UK-EN Focus) ---
    if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
        const SpeechConstructor = window.webkitSpeechRecognition || window.SpeechRecognition;
        recognition = new SpeechConstructor();
        recognition.continuous = false;
        recognition.interimResults = false;
        recognition.maxAlternatives = 3; // Checks top 3 guesses for UK accents

        recognition.onresult = (e) => {
            let heardList = [];
            for (let i = 0; i < e.results[0].length; i++) {
                heardList.push(e.results[0][i].transcript.toLowerCase());
            }
            // Update the Heard Display with the primary guess
            const primaryGuess = e.results[0][0].transcript;
            const heardBox = document.getElementById('heardDisplay');
            heardBox.innerText = `Heard: "${primaryGuess}"`;
            heardBox.style.display = 'block';
            
            handleVoice(heardList);
        };
        recognition.onend = () => { document.getElementById('micStatus').style.display = 'none'; };
    }

    function setDir(d) {
        dir = d;
        document.getElementById('btnPlEn').classList.toggle('active', d==='pl-en');
        document.getElementById('btnEnPl').classList.toggle('active', d==='en-pl');
    }

    function toggleHF() {
        isHF = !isHF;
        document.getElementById('hfToggle').innerText = isHF ? "STOP HANDS-FREE" : "ENABLE HANDS-FREE";
        if(isHF) generateNext();
    }

    function generateNext() {
        let min = parseInt(document.getElementById('minIn').value);
        let max = parseInt(document.getElementById('maxIn').value);
        let n = Math.floor(Math.random() * (max - min + 1)) + min;
        
        english = n.toString();
        polish = numToPl(n);
        
        document.getElementById('numDisp').innerText = (dir === 'en-pl') ? english : "???";
        document.getElementById('heardDisplay').style.display = 'none';

        let msg = (dir === 'pl-en') ? polish : english;
        let lang = (dir === 'pl-en') ? 'pl-PL' : 'en-GB'; // Force UK English
        speak(msg, lang);

        if(isHF && recognition) {
            recognition.lang = (dir === 'pl-en') ? 'en-GB' : 'pl-PL';
            setTimeout(() => {
                document.getElementById('micStatus').style.display = 'block';
                try { recognition.start(); } catch(e){}
            }, 1800);
        }
    }

    function handleVoice(attempts) {
        let target = (dir === 'pl-en') ? english : polish;
        let targetClean = target.toLowerCase().replace(/[-\s]/g, '');

        // Smart check: Does any alternative match the word or digits?
        const isMatch = attempts.some(said => {
            let saidClean = said.replace(/[-\s]/g, '');
            return saidClean === targetClean || said.includes(target.toLowerCase());
        });

        if(isMatch) {
            speak(dir === 'pl-en' ? "Correct" : "Dobrze", dir === 'pl-en' ? 'en-GB' : 'pl-PL');
            document.getElementById('numDisp').innerText = "‚úì " + target;
            setTimeout(generateNext, 1800);
        } else {
            speak(dir === 'pl-en' ? "No, " + english : "Nie, " + polish, dir === 'pl-en' ? 'en-GB' : 'pl-PL');
            document.getElementById('numDisp').innerText = "‚úó " + target;
            setTimeout(generateNext, 3500);
        }
    }

    function speak(t, l) {
        window.speechSynthesis.cancel();
        let u = new SpeechSynthesisUtterance(t);
        u.lang = l; 
        u.rate = 0.85; 
        u.pitch = 0.9; // Lowered pitch for more natural male tone
        window.speechSynthesis.speak(u);
    }

    function numToPl(n) {
        const u = ["", "jeden", "dwa", "trzy", "cztery", "piƒôƒá", "sze≈õƒá", "siedem", "osiem", "dziewiƒôƒá"];
        const t1 = ["dziesiƒôƒá", "jedena≈õcie", "dwana≈õcie", "trzyna≈õcie", "czterna≈õcie", "piƒôtna≈õcie", "szesna≈õcie", "siedemna≈õcie", "osiemna≈õcie", "dziewiƒôtna≈õcie"];
        const t10 = ["", "", "dwadzie≈õcia", "trzydzie≈õci", "czterdzie≈õci", "piƒôƒádziesiƒÖt", "sze≈õƒádziesiƒÖt", "siedemdziesiƒÖt", "osiemdziesiƒÖt", "dziewiƒôƒádziesiƒÖt"];
        const h = ["", "sto", "dwie≈õcie", "trzysta", "czterysta", "piƒôƒáset", "sze≈õƒáset", "siedemset", "osiemset", "dziewiƒôtset"];
        if (n === 0) return "zero";
        let res = "";
        let hn = Math.floor(n / 100), tn = Math.floor((n % 100) / 10), un = n % 10;
        if (hn > 0) res += h[hn] + " ";
        if (tn === 1) res += t1[un];
        else { if (tn > 1) res += t10[tn] + " "; if (un > 0) res += u[un]; }
        return res.trim();
    }
</script>
</body>
</html>

